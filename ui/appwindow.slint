import { Button, VerticalBox, LineEdit, ComboBox, HorizontalBox, TextEdit, ProgressIndicator, ScrollView, ListView } from "std-widgets.slint";

export global AeroPalette {
    out property <color> bg-gradient-start: #e0f7fa; 
    out property <color> bg-gradient-end: #ffffff;
    
    out property <color> glass-surface: #ffffffa0;
    out property <color> glass-border: #ffffff;
    
    out property <color> text-primary: #004d40;
    out property <color> text-secondary: #00695c;
    
    out property <color> button-top: #00b0ff;
    out property <color> button-bottom: #0081cb;
    out property <color> button-border: #005b9f;
    
    out property <color> button-hover-top: #40c4ff;
    out property <color> button-hover-bottom: #0091ea;
}

component AeroButton inherits Rectangle {
    in property <string> text;
    in property <bool> enabled: true;
    in property <bool> primary: true;
    callback clicked;
    
    height: 38px;
    border-radius: 19px; // Pill shape
    
    background: @linear-gradient(180deg, 
        enabled ? (touch.has-hover ? AeroPalette.button-hover-top : AeroPalette.button-top) : #cfd8dc, 
        enabled ? (touch.has-hover ? AeroPalette.button-hover-bottom : AeroPalette.button-bottom) : #b0bec5
    );
    
    border-width: 1px;
    border-color: enabled ? AeroPalette.button-border : #90a4ae;
    
    // Shine effect
    Rectangle {
        x: 2px; y: 2px;
        width: parent.width - 4px;
        height: parent.height / 2 - 2px;
        border-top-left-radius: 17px;
        border-top-right-radius: 17px;
        background: @linear-gradient(180deg, #ffffffa0, #ffffff10);
    }
    
    touch := TouchArea {
        width: 100%; height: 100%;
        clicked => { if (root.enabled) { root.clicked(); } }
        mouse-cursor: root.enabled ? pointer : default;
    }
    
    Text {
        text: root.text;
        color: root.enabled ? #ffffff : #f0f0f0;
        font-weight: 700;
        font-size: 14px;
        vertical-alignment: center;
        horizontal-alignment: center;
    }
}

component AeroGlassPanel inherits Rectangle {
    background: AeroPalette.glass-surface;
    border-radius: 12px;
    border-width: 1px;
    border-color: AeroPalette.glass-border;
    
    // Subtle shadow
    drop-shadow-offset-x: 0px;
    drop-shadow-offset-y: 4px;
    drop-shadow-blur: 10px;
    drop-shadow-color: #00000010;
}

export component AppWindow inherits Window {
    title: "YT-DLP Aero";
    min-width: 700px;
    min-height: 550px;
    background: @linear-gradient(135deg, AeroPalette.bg-gradient-start, AeroPalette.bg-gradient-end);

    in property <string> status_text: "Initializing...";
    in property <string> full_log: "System init...\n";
    in property <float> download_progress: 0.0;
    in property <bool> is_downloading: false;
    in property <string> download_path: "downloads";
    
    callback start_download(string, string, string); // url, format, quality
    callback choose_path();

    VerticalBox {
        padding: 30px;
        spacing: 20px;

        // Title Area
        HorizontalBox {
            alignment: center;
            Text {
                text: "YouTube Downloader Professional";
                font-size: 26px;
                font-weight: 800;
                color: AeroPalette.text-primary;
            }
        }

        // Main Control Panel
        AeroGlassPanel {
            VerticalBox {
                padding: 20px;
                spacing: 15px;

                // Path Selector
                HorizontalBox {
                   spacing: 10px;
                   Text { text: "Save to:"; vertical-alignment: center; color: AeroPalette.text-secondary; width: 60px; }
                   LineEdit {
                       text: root.download_path;
                       enabled: false; // Read-only, set via dialog
                       height: 32px;
                       horizontal-stretch: 1;
                   }
                   AeroButton {
                       text: "Browse...";
                       width: 80px;
                       height: 32px;
                       clicked => { root.choose_path(); }
                   }
                }

                // URL Input
                VerticalBox {
                    spacing: 5px;
                    Text { text: "Video URL:"; color: AeroPalette.text-secondary; font-size: 13px; }
                    url_input := LineEdit {
                        placeholder-text: "Paste YouTube link here...";
                        font-size: 14px;
                        height: 38px;
                    }
                }

                // Options
                HorizontalBox {
                    spacing: 20px;
                    
                    VerticalBox {
                        spacing: 5px;
                        Text { text: "Format:"; color: AeroPalette.text-secondary; font-size: 13px; }
                        format_combo := ComboBox {
                            model: ["Video (MP4)", "Audio (MP3)"];
                            current-value: "Video (MP4)";
                            height: 38px;
                        }
                    }
                    
                    VerticalBox {
                        spacing: 5px;
                        Text { text: "Quality:"; color: AeroPalette.text-secondary; font-size: 13px; }
                        quality_combo := ComboBox {
                            model: ["Best", "1080p", "720p", "480p", "Audio Only"];
                            current-value: "Best";
                            height: 38px;
                        }
                    }
                }
            }
        }

        // Progress Bar
        if (root.download_progress > 0.0 || root.is_downloading): VerticalBox {
             spacing: 6px;
             HorizontalBox {
                 Text { text: root.is_downloading ? "Downloading..." : "Done"; color: AeroPalette.text-secondary; font-size: 12px; }
                 Text { text: Math.round(root.download_progress * 100) + "%"; color: AeroPalette.button-bottom; horizontal-alignment: right; font-weight: 700; }
             }
             // Glossy Progress Bar Container
             Rectangle {
                 height: 14px;
                 background: #e0e0e0;
                 border-radius: 7px;
                 border-width: 1px;
                 border-color: #bdbdbd;
                 clip: true;
                 
                 // Progress Fill
                 Rectangle {
                     x: 0;
                     width: parent.width * root.download_progress;
                     height: 100%;
                     background: @linear-gradient(180deg, #b9f6ca, #00c853); // Green-ish Aero
                     border-radius: 6px;
                     animate width { duration: 200ms; easing: ease-out; }
                     
                     // Shine on progress
                     Rectangle {
                         x: 0; y: 0; width: parent.width; height: 50%;
                         background: #ffffff60;
                         border-radius: 6px;
                     }
                 }
             }
        }

        // Action Button
        AeroButton {
            text: root.is_downloading ? "Processing..." : "START DOWNLOAD";
            height: 45px;
            enabled: !root.is_downloading && url_input.text != "";
            clicked => {
                root.start_download(url_input.text, format_combo.current-value, quality_combo.current-value);
            }
        }

        // Log Area
        VerticalBox {
            spacing: 5px;
            Text { text: "Activity Log:"; color: AeroPalette.text-secondary; font-size: 12px; }
            Rectangle {
                background: #ffffff;
                border-radius: 6px;
                border-color: #cfd8dc;
                border-width: 1px;
                height: 120px; // Taller for logs
                
                TextEdit {
                    text: root.full_log;
                    font-size: 11px;
                    read-only: true;
                    wrap: word-wrap;
                }
            }
        }
    }
}
